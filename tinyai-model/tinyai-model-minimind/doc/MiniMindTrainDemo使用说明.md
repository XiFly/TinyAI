# MiniMind å®Œæ•´è®­ç»ƒæ¼”ç¤ºä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`MiniMindTrainDemo` æ˜¯å‚è€ƒ `DeepSeekV3TrainDemoV2` å®ç°çš„å®Œæ•´è®­ç»ƒæµç¨‹æ¼”ç¤º,ä¸“ä¸ºæ•™å­¦å’Œå­¦ä¹ åœºæ™¯è®¾è®¡ã€‚å®ƒå±•ç¤ºäº†MiniMindæ¨¡å‹ä»æ•°æ®å‡†å¤‡ã€é¢„è®­ç»ƒã€å¾®è°ƒåˆ°å¼ºåŒ–å­¦ä¹ è®­ç»ƒçš„å®Œæ•´æµç¨‹ã€‚

## æ ¸å¿ƒç‰¹æ€§

### 1. çœŸå®æ•°æ®é›†ç”Ÿæˆ

ä¸åŒäºè™šæ‹Ÿéšæœºæ•°æ®,æœ¬æ¼”ç¤ºç”Ÿæˆäº†çœŸå®çš„æ•™å­¦æ–‡æœ¬æ•°æ®:

- **é¢„è®­ç»ƒæ•°æ®é›†** (~150æ¡):
  - æ·±åº¦å­¦ä¹ åŸºç¡€çŸ¥è¯† (30æ¡)
  - è‡ªç„¶è¯­è¨€å¤„ç†çŸ¥è¯† (30æ¡)
  - æœºå™¨å­¦ä¹ æ¦‚å¿µ (30æ¡)
  - AIä¼¦ç†ä¸åº”ç”¨ (30æ¡)
  - ç¼–ç¨‹ä¸è½¯ä»¶å¼€å‘ (30æ¡)

- **ç›‘ç£å¾®è°ƒæ•°æ®é›†** (~60æ¡):
  - é—®ç­”å¯¹ (Question-Answer)
  - æŒ‡ä»¤è·Ÿéš (Instruction-Answer)
  - ä»»åŠ¡æ‰§è¡Œ (Task-Answer)

- **å¼ºåŒ–å­¦ä¹ æ•°æ®é›†** (~40æ¡):
  - å¸¦å¥–åŠ±æ ‡ç­¾çš„æ ·æœ¬
  - å¥–åŠ±èŒƒå›´: 0.7-1.0

### 2. å®Œæ•´è®­ç»ƒæµç¨‹

#### é˜¶æ®µ0: æ•°æ®å‡†å¤‡
```
./data/minimind_training/
â”œâ”€â”€ pretrain.txt           # é¢„è®­ç»ƒæ•°æ® (~150æ¡)
â”œâ”€â”€ sft_train.txt          # SFTè®­ç»ƒé›† (~60æ¡)
â”œâ”€â”€ sft_val.txt            # SFTéªŒè¯é›† (~10æ¡)
â””â”€â”€ rl_train.txt           # RLè®­ç»ƒæ•°æ® (~40æ¡)
```

#### é˜¶æ®µ1: æ— ç›‘ç£é¢„è®­ç»ƒ (Unsupervised Pretraining)
- **ç›®æ ‡**: å­¦ä¹ è¯­è¨€çš„é€šç”¨è¡¨ç¤ºå’Œè¯­æ³•
- **ä»»åŠ¡**: å› æœè¯­è¨€å»ºæ¨¡ï¼ˆé¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼‰
- **æ•°æ®**: å¤§è§„æ¨¡æ— æ ‡æ³¨æ–‡æœ¬
- **å­¦ä¹ ç‡**: 1e-2
- **è®­ç»ƒè½®æ¬¡**: 3 epochs
- **ç‰¹è‰²**: åŸºç¡€è¯­è¨€ç†è§£èƒ½åŠ›

#### é˜¶æ®µ2: ç›‘ç£å¾®è°ƒ (Supervised Fine-tuning / SFT)
- **ç›®æ ‡**: å­¦ä¹ éµå¾ªæŒ‡ä»¤å’Œç”Ÿæˆé«˜è´¨é‡å›ç­”
- **ä»»åŠ¡**: æŒ‡ä»¤å¾®è°ƒï¼ˆé—®ç­”å¯¹ï¼‰
- **æ•°æ®**: å¸¦æ ‡ç­¾çš„æŒ‡ä»¤-å›ç­”æ•°æ®
- **å­¦ä¹ ç‡**: 1e-3 (æ¯”é¢„è®­ç»ƒä½10å€)
- **è®­ç»ƒè½®æ¬¡**: 3 epochs
- **ç‰¹è‰²**: æŒ‡ä»¤è·Ÿéšèƒ½åŠ›

#### é˜¶æ®µ3: å¼ºåŒ–å­¦ä¹ è®­ç»ƒ (Reinforcement Learning / RLAIF)
- **ç›®æ ‡**: é€šè¿‡å¥–åŠ±ä¿¡å·å¯¹é½æ¨¡å‹è¡Œä¸º
- **ä»»åŠ¡**: æœ€å¤§åŒ–å¥–åŠ±å‡½æ•°
- **æ•°æ®**: å¸¦å¥–åŠ±æ ‡æ³¨çš„æ ·æœ¬
- **å­¦ä¹ ç‡**: 5e-4 (æå°å­¦ä¹ ç‡)
- **è®­ç»ƒè½®æ¬¡**: 2 epochs
- **ç‰¹è‰²**: è¡Œä¸ºå¯¹é½å’Œè´¨é‡ä¼˜åŒ–

#### é˜¶æ®µ4: æ¨ç† (Inference)
- **ç­–ç•¥**: Greedyè§£ç 
- **è¾“å…¥**: æç¤ºè¯æ–‡æœ¬
- **è¾“å‡º**: ç”Ÿæˆçš„å®Œæ•´æ–‡æœ¬

### 3. è¶…å°è§„æ¨¡é…ç½®

æ¼”ç¤ºä½¿ç”¨"Micro"é…ç½®,ä¾¿äºå¿«é€Ÿæ‰§è¡Œ:

```java
- è¯æ±‡è¡¨å¤§å°: ~800-1000 (åŸºäºå®é™…æ•°æ®)
- æœ€å¤§åºåˆ—é•¿åº¦: 64
- éšè—ç»´åº¦: 128
- å±‚æ•°: 2
- æ³¨æ„åŠ›å¤´æ•°: 4
- FFNéšè—ç»´åº¦: 256
- Dropout: 0.1
```

## å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæ¼”ç¤º

```bash
# è¿›å…¥æ¨¡å—ç›®å½•
cd tinyai-model/tinyai-model-minimind

# ç¼–è¯‘é¡¹ç›®
mvn clean compile

# è¿è¡Œæ¼”ç¤º
mvn exec:java -Dexec.mainClass="io.leavesfly.tinyai.minimind.training.MiniMindTrainDemo"
```

### 2. æŸ¥çœ‹è¾“å‡º

æ¼”ç¤ºä¼šè‡ªåŠ¨:
1. åœ¨ `./data/minimind_training/` ç›®å½•ä¸‹ç”Ÿæˆæ•°æ®é›†æ–‡ä»¶
2. ä¾æ¬¡æ‰§è¡Œé¢„è®­ç»ƒã€SFTã€RLè®­ç»ƒ
3. è¾“å‡ºæ¯ä¸ªé˜¶æ®µçš„è®­ç»ƒè¿›åº¦å’ŒæŸå¤±
4. æœ€åæ‰§è¡Œæ¨ç†æµ‹è¯•

### 3. é¢„æœŸè¾“å‡ºç¤ºä¾‹

```
================================================================================
MiniMind å®Œæ•´è®­ç»ƒä¸æ¨ç†æ¼”ç¤º
é€‚ç”¨äºæ•™å­¦å’Œå­¦ä¹ çš„è¶…å°è§„æ¨¡æ•°æ®é›†è®­ç»ƒæ–¹æ¡ˆ
================================================================================

================================================================================
ğŸ“¦ æ­¥éª¤0: å‡†å¤‡è®­ç»ƒæ•°æ®é›†
================================================================================

ğŸ“ ç”Ÿæˆé¢„è®­ç»ƒæ•°æ®é›†...
  âœ“ é¢„è®­ç»ƒæ•°æ®: 150 æ¡
  âœ“ ä¿å­˜è·¯å¾„: ./data/minimind_training/pretrain.txt

ğŸ“ ç”Ÿæˆç›‘ç£å¾®è°ƒæ•°æ®é›†...
  âœ“ SFTè®­ç»ƒé›†: 60 æ¡
  âœ“ ä¿å­˜è·¯å¾„: ./data/minimind_training/sft_train.txt
  âœ“ SFTéªŒè¯é›†: 10 æ¡
  âœ“ ä¿å­˜è·¯å¾„: ./data/minimind_training/sft_val.txt

ğŸ“ ç”Ÿæˆå¼ºåŒ–å­¦ä¹ æ•°æ®é›†...
  âœ“ RLè®­ç»ƒæ•°æ®: 40 æ¡
  âœ“ ä¿å­˜è·¯å¾„: ./data/minimind_training/rl_train.txt

âœ… æ•°æ®é›†å‡†å¤‡å®Œæˆ!

================================================================================
ğŸ“š æ­¥éª¤1: MiniMind æ— ç›‘ç£é¢„è®­ç»ƒ (Unsupervised Pretraining)
================================================================================

ğŸ“ åŠ è½½æ‰€æœ‰æ•°æ®ä»¥æ„å»ºè¯æ±‡è¡¨...
  âœ“ é¢„è®­ç»ƒæ•°æ®: 150 æ¡
  âœ“ SFTè®­ç»ƒæ•°æ®: 60 æ¡
  âœ“ SFTéªŒè¯æ•°æ®: 10 æ¡
  âœ“ RLè®­ç»ƒæ•°æ®: 40 æ¡

ğŸ“ æ„å»ºå®Œæ•´è¯æ±‡è¡¨...
  âœ“ å®Œæ•´è¯æ±‡è¡¨å¤§å°: 853
  âœ“ è¯æ±‡è¡¨å·²å†»ç»“,åç»­ä¸å†å¢åŠ æ–°è¯

ğŸ“ åˆ›å»ºMiniMindæ¨¡å‹...
  âœ“ æ¨¡å‹é…ç½®: Micro (æ•™å­¦ä¸“ç”¨)
  âœ“ è¯æ±‡è¡¨å¤§å°: 853
  âœ“ éšè—ç»´åº¦: 128
  âœ“ å±‚æ•°: 2
  âœ“ æ³¨æ„åŠ›å¤´æ•°: 4
  âœ“ æœ€å¤§åºåˆ—é•¿åº¦: 64

ğŸ“ å¼€å§‹æ— ç›‘ç£é¢„è®­ç»ƒ...
  - è®­ç»ƒç›®æ ‡: å› æœè¯­è¨€å»ºæ¨¡ (ä¸‹ä¸€ä¸ªè¯é¢„æµ‹)
  - å­¦ä¹ ç‡: 1e-2
  - è®­ç»ƒè½®æ¬¡: 3 epochs
--------------------------------------------------------------------------------
Epoch 1/3 - Loss: X.XXXX
Epoch 2/3 - Loss: X.XXXX
Epoch 3/3 - Loss: X.XXXX
--------------------------------------------------------------------------------

âœ… æ— ç›‘ç£é¢„è®­ç»ƒå®Œæˆ!

ğŸ’¡ é¢„è®­ç»ƒé˜¶æ®µæ€»ç»“:
  - ç›®æ ‡: å­¦ä¹ è¯­è¨€çš„é€šç”¨è¡¨ç¤ºå’Œè¯­æ³•
  - ä»»åŠ¡: å› æœè¯­è¨€å»ºæ¨¡(é¢„æµ‹ä¸‹ä¸€ä¸ªè¯)
  - æ•°æ®: å¤§è§„æ¨¡æ— æ ‡æ³¨æ–‡æœ¬
  - æŠ€å·§: è¾ƒé«˜å­¦ä¹ ç‡ + å¤šè½®è®­ç»ƒ

... (åç»­é˜¶æ®µç±»ä¼¼è¾“å‡º)
```

## æ•°æ®é›†æ ¼å¼è¯´æ˜

### é¢„è®­ç»ƒæ•°æ®æ ¼å¼
çº¯æ–‡æœ¬,æ¯è¡Œä¸€ä¸ªå¥å­:
```
Deep learning is a subset of machine learning that uses neural networks
Neural networks consist of interconnected layers of neurons
...
```

### SFTæ•°æ®æ ¼å¼
æŒ‡ä»¤-å›ç­”å¯¹:
```
Question: What is deep learning? Answer: Deep learning is a subset of machine learning using neural networks with multiple layers
Instruction: Write a Python function to add two numbers Answer: def add(a, b): return a + b
...
```

### RLæ•°æ®æ ¼å¼
å¸¦å¥–åŠ±æ ‡ç­¾çš„æ ·æœ¬:
```
[REWARD:1.0] Question: What is machine learning? Answer: Machine learning enables computers to learn from data without explicit programming
[REWARD:0.9] Question: Explain neural networks Answer: Neural networks are computing systems inspired by biological brains
...
```

## æ‰©å±•å’Œå®šåˆ¶

### 1. è°ƒæ•´æ•°æ®é›†è§„æ¨¡

ä¿®æ”¹æ•°æ®ç”Ÿæˆå‡½æ•°,æ·»åŠ æˆ–åˆ é™¤æ–‡æœ¬:

```java
private static void generatePretrainDataset() throws IOException {
    List<String> pretrainTexts = new ArrayList<>();
    
    // æ·»åŠ æ›´å¤šæ–‡æœ¬...
    pretrainTexts.addAll(Arrays.asList(
        "Your custom text here...",
        // ...
    ));
    
    writeToFile(pretrainTexts, DATA_DIR + "/pretrain.txt");
}
```

### 2. è°ƒæ•´æ¨¡å‹é…ç½®

ä¿®æ”¹ `createMicroConfig()` æ–¹æ³•:

```java
private static MiniMindConfig createMicroConfig(int vocabSize) {
    MiniMindConfig config = new MiniMindConfig();
    config.setVocabSize(vocabSize);
    config.setMaxSeqLen(128);      // å¢åŠ åºåˆ—é•¿åº¦
    config.setHiddenSize(256);     // å¢åŠ éšè—ç»´åº¦
    config.setNumLayers(4);        // å¢åŠ å±‚æ•°
    // ...
    return config;
}
```

### 3. è°ƒæ•´è®­ç»ƒè¶…å‚æ•°

ä¿®æ”¹è®­ç»ƒè°ƒç”¨:

```java
trainModel(model, sequences, maxSeqLen, 
    4,      // å¢åŠ batch size
    5,      // å¢åŠ epochs
    1e-3f   // è°ƒæ•´å­¦ä¹ ç‡
);
```

## ä¸DeepSeekV3TrainDemoV2çš„å¯¹æ¯”

| ç‰¹æ€§ | DeepSeekV3TrainDemoV2 | MiniMindTrainDemo |
|------|----------------------|-------------------|
| æ¨¡å‹æ¶æ„ | MoE + Task-aware | Standard Transformer |
| ä¸“å®¶ç³»ç»Ÿ | âœ… (8ä¸“å®¶, Top-2) | âŒ |
| ä»»åŠ¡æ„ŸçŸ¥ | âœ… (5ç§ä»»åŠ¡ç±»å‹) | âŒ |
| ç¨€ç–æ¿€æ´» | âœ… (25%æ¿€æ´»ç‡) | âŒ |
| æ•°æ®è§„æ¨¡ | ~350æ¡ | ~250æ¡ |
| è¯æ±‡è¡¨ | ~1500è¯ | ~850è¯ |
| è®­ç»ƒé˜¶æ®µ | é¢„è®­ç»ƒ+åè®­ç»ƒ+ä»£ç ä¸“é¡¹ | é¢„è®­ç»ƒ+SFT+RL |
| RLè®­ç»ƒ | âŒ | âœ… RLAIF |

## å…³é”®ä»£ç ç»„ä»¶

### ç®€å•åˆ†è¯å™¨

```java
SimpleTokenizer tokenizer = new SimpleTokenizer();
List<Integer> tokens = tokenizer.encode("What is machine learning");
String text = tokenizer.decode(tokens.stream().mapToInt(i->i).toArray());
```

### æ•°æ®é›†åˆ›å»º

```java
List<int[]> sequences = new ArrayList<>();
for (String text : texts) {
    List<Integer> tokens = tokenizer.encode(text);
    int[] sequence = tokens.stream().mapToInt(Integer::intValue).toArray();
    // å¡«å……åˆ°å›ºå®šé•¿åº¦...
    sequences.add(paddedSeq);
}
```

### æ¨¡å‹è®­ç»ƒ

```java
trainModel(model, sequences, maxSeqLen, batchSize, epochs, learningRate);
```

## æŠ€æœ¯è¦ç‚¹

### 1. è¯æ±‡è¡¨ç®¡ç†

- åœ¨é¢„è®­ç»ƒé˜¶æ®µæ„å»ºå®Œæ•´è¯æ±‡è¡¨
- åŸºäºæ‰€æœ‰é˜¶æ®µçš„æ•°æ®æ„å»º,é¿å…æœªçŸ¥è¯
- è®­ç»ƒå‰å†»ç»“è¯æ±‡è¡¨

### 2. å­¦ä¹ ç‡è°ƒåº¦

- é¢„è®­ç»ƒ: 1e-2 (è¾ƒé«˜,å¿«é€Ÿå­¦ä¹ )
- SFT: 1e-3 (é™ä½10å€,ç²¾ç»†è°ƒæ•´)
- RL: 5e-4 (æå°,ç¨³å®šä¼˜åŒ–)

### 3. æ•°æ®å¡«å……

- ä½¿ç”¨PAD_TOKEN_ID (0) å¡«å……åºåˆ—
- é¿å…ä¸è¯æ±‡IDå†²çª
- åœ¨è§£ç æ—¶è‡ªåŠ¨è·³è¿‡PAD token

### 4. å¥–åŠ±ä¿¡å·å¤„ç†

- ä»æ–‡æœ¬ä¸­æå–å¥–åŠ±å€¼
- æ”¯æŒ0.0-1.0èŒƒå›´çš„å¥–åŠ±
- åœ¨è®­ç»ƒæ—¶ç”¨äºæŒ‡å¯¼ä¼˜åŒ–

## æ³¨æ„äº‹é¡¹

### 1. å†…å­˜è¦æ±‚

- Microé…ç½®è®¾è®¡ç”¨äºä½å†…å­˜ç¯å¢ƒ
- å¯åœ¨8GB RAMä¸‹è¿è¡Œ
- å¦‚éœ€æ›´å¤§æ¨¡å‹,è¯·è°ƒæ•´JVMå‚æ•°

### 2. è®­ç»ƒæ—¶é—´

- å®Œæ•´æµç¨‹çº¦5-15åˆ†é’Ÿ
- å–å†³äºç¡¬ä»¶æ€§èƒ½
- å¯å‡å°‘epochsåŠ å¿«æ¼”ç¤º

### 3. æ”¶æ•›æ€§

- è¶…å°æ•°æ®é›†ä¸»è¦ç”¨äºæ¼”ç¤º
- Losså¯èƒ½ä¸ä¼šé™åˆ°å¾ˆä½
- é‡ç‚¹åœ¨äºæµç¨‹å®Œæ•´æ€§

### 4. ç”Ÿæˆè´¨é‡

- å—é™äºæ¨¡å‹è§„æ¨¡å’Œæ•°æ®é‡
- ç”Ÿæˆç»“æœå¯èƒ½ä¸å¤ªè¿è´¯
- ä¸»è¦ç”¨äºç†è§£è®­ç»ƒæµç¨‹

## æ•…éšœæ’é™¤

### é—®é¢˜1: OutOfMemoryError

**è§£å†³æ–¹æ¡ˆ**: å‡å°batch sizeæˆ–æ¨¡å‹è§„æ¨¡

```java
// å‡å°batch size
trainModel(model, sequences, maxSeqLen, 1, epochs, learningRate);

// æˆ–å‡å°æ¨¡å‹é…ç½®
config.setHiddenSize(64);
config.setNumLayers(1);
```

### é—®é¢˜2: è¯æ±‡è¡¨å¤ªå¤§

**è§£å†³æ–¹æ¡ˆ**: é™åˆ¶æ•°æ®é‡æˆ–ç®€åŒ–æ–‡æœ¬

```java
// å‡å°‘æ•°æ®æ¡æ•°
pretrainTexts = pretrainTexts.subList(0, 50);
```

### é—®é¢˜3: è®­ç»ƒä¸æ”¶æ•›

**è§£å†³æ–¹æ¡ˆ**: è°ƒæ•´å­¦ä¹ ç‡

```java
// é™ä½å­¦ä¹ ç‡
trainModel(model, sequences, maxSeqLen, batchSize, epochs, 1e-3f);
```

## ç›¸å…³æ–‡æ¡£

- `README.md` - MiniMindæ¨¡å—æ€»è§ˆ
- `MiniMindæ¨¡å‹è®¾è®¡.md` - æ¨¡å‹æ¶æ„è¯¦è§£
- `å¿«é€Ÿå¼€å§‹æŒ‡å—.md` - åŸºç¡€ä½¿ç”¨æ•™ç¨‹
- `APIå‚è€ƒ.md` - APIæ–‡æ¡£

## æ€»ç»“

`MiniMindTrainDemo` æä¾›äº†ä¸€ä¸ªå®Œæ•´ã€å¯è¿è¡Œçš„MiniMindæ¨¡å‹è®­ç»ƒæ¼”ç¤º,ç‰¹åˆ«é€‚åˆ:

- âœ… å­¦ä¹ å®Œæ•´çš„LLMè®­ç»ƒæµç¨‹
- âœ… ç†è§£é¢„è®­ç»ƒã€SFTã€RLä¸‰é˜¶æ®µè®­ç»ƒ
- âœ… ä½“éªŒä»æ•°æ®å‡†å¤‡åˆ°æ¨ç†çš„å®Œæ•´å‘¨æœŸ
- âœ… å®éªŒä¸åŒçš„è®­ç»ƒç­–ç•¥å’Œè¶…å‚æ•°

å®ƒç®€åŒ–äº†å¤æ‚çš„è®­ç»ƒæµç¨‹,ä½¿ç”¨è¶…å°è§„æ¨¡é…ç½®,ç¡®ä¿åœ¨æ™®é€šç¡¬ä»¶ä¸Šä¹Ÿèƒ½å¿«é€Ÿè¿è¡Œ,éå¸¸é€‚åˆæ•™å­¦å’Œå­¦ä¹ ç›®çš„ã€‚
